<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mieloka â€” Marketplace Mie Lokal</title>
  <meta name="description" content="Mieloka â€” UMKM lokal F&B. Martabak, Somtam, Tomyam, Mie Thai, Es Jimi. Pesan via WhatsApp." />
  <style>
    :root{--bg:#071226;--card:#0d1624;--accent:#ffb86b;--text:#e6eef6;--muted:#98a6b6}
    body{margin:0;font-family:Inter,system-ui; background:var(--bg);color:var(--text)}
    .wrap{max-width:1000px;margin:28px auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:12px}
    .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .btn{background:var(--accent);color:#071226;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .cart-float{position:fixed;right:18px;bottom:18px;background:var(--accent);padding:12px 14px;border-radius:999px;z-index:999;cursor:pointer;color:#071226}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1200}
    .modal .panel{width:100%;max-width:760px;background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .field{margin-bottom:10px}
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    input[type="text"], input[type="tel"], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    textarea{min-height:72px;resize:vertical}
    .small{font-size:13px;color:var(--muted)}
    .flex{display:flex;gap:8px}
  </style>
</head>
<body>
  <main class="wrap">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px">
      <div>
        <h1 style="margin:0;color:var(--accent)">MIELOKA</h1>
        <div class="small">UMKM Lokal F&B â€” Martabak â€¢ Somtam â€¢ Tomyam â€¢ Mie Thai â€¢ Es Jimi</div>
      </div>
    </header>

    <section>
      <h2 style="margin:6px 0 12px">Menu</h2>
      <div class="grid" id="catalog"></div>
    </section>

    <footer style="margin-top:18px" class="small">Â© <span id="year"></span> Mieloka</footer>
  </main>

  <div class="cart-float" id="cart-float">ðŸ›’ Keranjang (<span id="cart-count">0</span>)</div>

  <!-- Checkout Modal -->
  <div class="modal" id="modal">
    <div class="panel" role="dialog" aria-modal="true">
      <h3>Checkout â€” Isi Data Pemesanan</h3>
      <div class="field">
        <label>Ringkasan Pesanan</label>
        <div id="order-summary" style="background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px"></div>
      </div>

      <form id="checkout-form">
        <div class="field"><label>Nama Pemesan *</label><input id="cust-name" type="text" required></div>
        <div class="field"><label>No. Telepon / WhatsApp *</label><input id="cust-tel" type="tel" required placeholder="08xxxxxxxxxx"></div>
        <div class="field"><label>Alamat Lengkap</label><textarea id="cust-address"></textarea></div>

        <div class="flex">
          <div style="flex:1">
            <label>Pengantaran *</label>
            <select id="cust-delivery" required>
              <option value="Pickup">Pickup</option>
              <option value="Kurir Lokal">Kurir Lokal</option>
              <option value="GoFood/GrabFood">GoFood / GrabFood</option>
            </select>
          </div>
          <div style="width:230px">
            <label>Pembayaran *</label>
            <select id="cust-pay" required>
              <option value="COD">COD (Bayar di tempat)</option>
              <option value="E-Wallet (OVO/Dana/ShopeePay)">E-Wallet (OVO / DANA / Shopeepay)</option>
              <option value="Transfer Bank">Transfer Bank</option>
            </select>
          </div>
        </div>

        <div class="field"><label>Catatan</label><textarea id="cust-note"></textarea></div>
        <div style="text-align:right;display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn ghost" id="btn-cancel">Batal</button>
          <button type="submit" class="btn" id="btn-submit">Kirim Pesanan</button>
        </div>
        <div id="submit-message" class="small" style="margin-top:10px"></div>
      </form>
    </div>
  </div>

  <script>
  // === CONFIG GOOGLE FORM ===
  const GOOGLE_FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSe5psqJPU768dvuCwbjXtdExS6j1AyUexcjBTJvYPWW0Cb0TA/formResponse';
  const GF_ENTRY_IDS = {
    cust_name: 'entry.398970537',
    cust_tel: 'entry.1806170338',
    cust_address: 'entry.822463516',
    cust_delivery: 'entry.843995223',
    cust_pay: 'entry.801141337',
    cust_note: 'entry.610885754',
    order_summary: 'entry.1361649100'
  };
  const OWNER_WA_NUMBER = '6285816415868';
  // === MENU DATA ===
  const PRODUCTS = [
    // Martabak
    {id:'m1', name:'Martabak Mie', price:22000},
    {id:'m2', name:'Martabak Usus', price:25000},
    {id:'m3', name:'Martabak Ayam', price:27000},
    {id:'m4', name:'Martabak Rempelo Ati', price:27000},
    {id:'m5', name:'Martabak Gajeh', price:28000},
    {id:'m6', name:'Martabak Aneka Rasa + Level', price:29000},
    // Somtam
    {id:'s1', name:'Somtam Tanpa Protein', price:25000},
    {id:'s2', name:'Somtam Udang', price:28000},
    {id:'s3', name:'Somtam Cumi', price:28000},
    {id:'s4', name:'Somtam Rajungan/Kepiting', price:30000},
    {id:'s5', name:'Somtam Kerang', price:29000},
    // Tomyam
    {id:'t1', name:'Tomyam Bakso-baksoan', price:28000},
    {id:'t2', name:'Tomyam Seafood', price:32000},
    {id:'t3', name:'Tomyam Beef', price:33000},
    // Mie
    {id:'n1', name:'Mie Thai', price:23000},
    {id:'n2', name:'Mie Chili Oil', price:23000},
    // Dessert
    {id:'d1', name:'Es Jimi', price:12000}
  ];

  const $=sel=>document.querySelector(sel);
  const currency=v=>'Rp '+v.toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');

  const catalog=$('#catalog');
  function renderCatalog(){
    catalog.innerHTML='';
    PRODUCTS.forEach(p=>{
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`
        <img src="https://picsum.photos/seed/${p.id}/400/300" alt="${p.name}">
        <div style="margin-top:6px">
          <div style="font-weight:700">${p.name}</div>
          <div class="small">${currency(p.price)}</div>
          <div class="row" style="margin-top:8px">
            <button class="btn" data-id="${p.id}">Tambah</button>
          </div>
        </div>`;
      catalog.appendChild(card);
    });
  }

  // CART
  const CART_KEY='mieloka_cart_v4';
  function loadCart(){try{return JSON.parse(localStorage.getItem(CART_KEY))||[]}catch(e){return[]}}
  function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c));updateCartUI();}
  function updateCartUI(){const c=loadCart();$('#cart-count').textContent=c.reduce((s,i)=>s+i.qty,0);}
  catalog.addEventListener('click',e=>{
    const btn=e.target.closest('button[data-id]');
    if(!btn)return;
    const id=btn.dataset.id;
    const p=PRODUCTS.find(x=>x.id===id);
    if(!p)return;
    const c=loadCart();
    const f=c.find(x=>x.id===id);
    if(f)f.qty+=1;else c.push({...p,qty:1});
    saveCart(c);
  });
  $('#cart-float').addEventListener('click',()=>{renderOrderSummary();$('#modal').style.display='flex';});
  $('#btn-cancel').addEventListener('click',()=>$('#modal').style.display='none');

  function renderOrderSummary(){
    const cart=loadCart();
    const box=$('#order-summary');
    if(cart.length===0){box.textContent='Keranjang kosong.';return;}
    let txt=cart.map(i=>`${i.qty}Ã— ${i.name} â€” ${currency(i.price*i.qty)}`).join('\n');
    const total=cart.reduce((s,i)=>s+i.price*i.qty,0);
    txt+=`\n\nTotal: ${currency(total)}`;
    box.textContent=txt;
  }

  $('#checkout-form').addEventListener('submit',async e=>{
    e.preventDefault();
    const cart=loadCart();
    if(cart.length===0){alert('Keranjang kosong.');return;}
    const f={
      name:$('#cust-name').value.trim(),
      tel:$('#cust-tel').value.trim(),
      addr:$('#cust-address').value.trim(),
      del:$('#cust-delivery').value,
      pay:$('#cust-pay').value,
      note:$('#cust-note').value.trim()
    };
    const orderLines=cart.map(i=>`${i.qty}Ã— ${i.name} â€” ${currency(i.price*i.qty)}`);
    const total=cart.reduce((s,i)=>s+i.price*i.qty,0);
    const summary=`${orderLines.join('\n')}\nTotal: ${currency(total)}\nMetode: ${f.pay}`;
    const payload=new URLSearchParams();
    payload.append(GF_ENTRY_IDS.order_summary,summary);
    payload.append(GF_ENTRY_IDS.cust_name,f.name);
    payload.append(GF_ENTRY_IDS.cust_tel,f.tel);
    payload.append(GF_ENTRY_IDS.cust_address,f.addr);
    payload.append(GF_ENTRY_IDS.cust_delivery,f.del);
    payload.append(GF_ENTRY_IDS.cust_pay,f.pay);
    payload.append(GF_ENTRY_IDS.cust_note,f.note);
    const btn=$('#btn-submit');btn.disabled=true;btn.textContent='Mengirim...';
    try{
      await fetch(GOOGLE_FORM_ACTION_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:payload.toString()});
      saveCart([]);
      const waMsg=encodeURIComponent(`Pesanan baru:\n${orderLines.join('\n')}\nTotal: ${currency(total)}\nNama: ${f.name}\nTel: ${f.tel}\nAlamat: ${f.addr}\nMetode: ${f.pay}\nPengantaran: ${f.del}\nCatatan: ${f.note}`);
      window.open(`https://wa.me/${OWNER_WA_NUMBER}?text=${waMsg}`,'_blank');
      btn.textContent='Terkirim âœ“';
      $('#submit-message').textContent='Pesanan berhasil dikirim ke Google Form dan notifikasi dikirim ke WhatsApp.';
    }catch(err){alert('Gagal mengirim. Periksa koneksi.');btn.disabled=false;btn.textContent='Kirim Pesanan';}
  });

  renderCatalog();updateCartUI();$('#year').textContent=new Date().getFullYear();
  </script>
</body>
</html>